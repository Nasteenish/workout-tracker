<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="theme-color" content="#08080F">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./icons/icon-192.png">
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./css/styles.css?v=41">
    <title>Трекер Тренировок</title>
</head>
<body>
    <div id="app"></div>
    <div id="debug" style="position:fixed;bottom:0;left:0;right:0;background:#300;color:#f88;font-size:11px;padding:4px 8px;max-height:30vh;overflow:auto;z-index:9999;display:none"></div>


    <script>
        // Show JS errors on screen
        window.onerror = function(msg, src, line, col, err) {
            var d = document.getElementById('debug');
            d.style.display = 'block';
            d.innerHTML += '<b>ERROR:</b> ' + msg + '<br>at ' + src + ':' + line + '<br>';
            return false;
        };
    </script>

    <script src="./js/utils.js?v=14"></script>
    <script src="./js/data.js?v=16"></script>
    <script src="./js/mikhail_data.js?v=1"></script>
    <script src="./js/users.js?v=2"></script>
    <script src="./js/storage.js?v=17"></script>
    <script src="./js/ui.js?v=33"></script>
    <script src="./js/timer.js?v=54"></script>
    <script src="./js/app.js?v=51"></script>

    <script>
        if ('serviceWorker' in navigator) {
            // One-time SW reset to clear corrupted state after rapid updates
            if (!localStorage.getItem('_swReset160')) {
                navigator.serviceWorker.getRegistrations().then(function(regs) {
                    return Promise.all(regs.map(function(r) { return r.unregister(); }));
                }).then(function() {
                    localStorage.setItem('_swReset160', '1');
                    return navigator.serviceWorker.register('./sw.js', { updateViaCache: 'none' });
                }).then(function(reg) { return reg.update(); });
            } else {
                navigator.serviceWorker.register('./sw.js', { updateViaCache: 'none' })
                    .then(function(reg) { return reg.update(); });
            }
        }
    </script>
</body>
</html>
